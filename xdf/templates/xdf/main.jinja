{% extends "base.jinja" %}

{% block extra_css %}
    <style>
    td:nth-child(3):after {
    content: 's';
}
td:nth-child(5):after {
    content: ' qu/s';
}
</style>
{% endblock %}

{% block content %}
<h1>Racing Records</h1>
    <ul class="nav nav-tabs">
        {% for i in servers %}
            <li {% if i.id == active_server.id %}class="active"{% endif %}>
                <a href="?{{ query_param(request, 'server_id', i.id) }}">{{ i.name }}</a>
            </li>
        {% endfor %}
    </ul>
    <div class="tab-content">
        <div class="tab-pane active">
            <h3>&nbsp;</h3>
             <table id="data-table" class="table table-striped table-bordered">

            </table>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
    var data = [
        {% for i in map_summary %}
            [
                '{{ i.name }}',
                '{{ i.time_record.player.nickname }}',
                {{ i.time_record.time / 100 }},
                '{{ i.speed_record.player.nickname }}',
                {{ i.speed_record.speed }},
                '{{ url('xdf:map_detail', active_server.id, i.id) }}'
            ],
        {% endfor %}
    ];
    $('#data-table').DataTable({
        data: data,
        columns: [{title: 'Map Name'}, {title: 'Best Time by'}, {title: 'Best Time'}, {title: 'Speed Record by'}, {title: 'Speed Record'}],
        columnDefs: [
            {
                "render": function ( data, type, row ) {
                    return '<a href="' + row[5] + '">' + data + '</a>';
                },
                "targets": 0
            },
            { visible: false, targets: 5}
        ]
    })
    </script>
{% endblock %}
